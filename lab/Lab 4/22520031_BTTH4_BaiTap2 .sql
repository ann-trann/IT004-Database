CREATE DATABASE QLGV
USE QLGV


CREATE TABLE HOCVIEN(
	MAHV CHAR(5) NOT NULL,
	HO VARCHAR(40),
	TEN VARCHAR(10),
	NGSINH SMALLDATETIME,
	GIOITINH VARCHAR(3),
	NOISINH VARCHAR(40),
	MALOP CHAR(3),
	CONSTRAINT PK_HV PRIMARY KEY (MAHV)
)

CREATE TABLE LOP(
	MALOP CHAR(3) NOT NULL,
	TENLOP VARCHAR(40),
	TRGLOP CHAR(5),
	SISO TINYINT,
	MAGVCN CHAR(4),
	CONSTRAINT PK_LOP PRIMARY KEY (MALOP)
)

CREATE TABLE KHOA(
	MAKHOA VARCHAR(4) NOT NULL,
	TENKHOA VARCHAR(40),
	NGTLAP SMALLDATETIME,
	TRGKHOA CHAR(4),
	CONSTRAINT PK_KHOA PRIMARY KEY (MAKHOA)
)

CREATE TABLE MONHOC(
	MAMH VARCHAR(10) NOT NULL,
	TENMH VARCHAR(40),
	TCLT TINYINT,
	TCTH TINYINT,
	MAKHOA VARCHAR(4),
	CONSTRAINT PK_MH PRIMARY KEY (MAMH)
)

CREATE TABLE DIEUKIEN(
	MAMH VARCHAR(10),
	MAMH_TRUOC VARCHAR(10)
	CONSTRAINT PK_DK PRIMARY KEY (MAMH, MAMH_TRUOC)
)

CREATE TABLE GIAOVIEN(
	MAGV CHAR(4) NOT NULL,
	HOTEN VARCHAR(40),
	HOCVI VARCHAR(10),
	HOCHAM VARCHAR(10),
	GIOITINH VARCHAR(3),
	NGSINH SMALLDATETIME,
	NGVL SMALLDATETIME,
	HESO NUMERIC(4,2),
	MUCLUONG MONEY,
	MAKHOA VARCHAR(4),
	CONSTRAINT PK_GV PRIMARY KEY (MAGV)
)

CREATE TABLE GIANGDAY(
	MALOP CHAR(3),
	MAMH VARCHAR(10),
	MAGV CHAR(4),
	HOCKY TINYINT,
	NAM SMALLINT,
	TUNGAY SMALLDATETIME,
	DENNGAY SMALLDATETIME,
	CONSTRAINT PK_GD PRIMARY KEY (MALOP, MAMH)
)

CREATE TABLE KETQUATHI(
	MAHV CHAR(5),
	MAMH VARCHAR(10),
	LANTHI TINYINT,
	NGTHI SMALLDATETIME,
	DIEM NUMERIC(4,2),
	KQUA VARCHAR(10)
	CONSTRAINT PK_KQT PRIMARY KEY (MAHV, MAMH, LANTHI)
)

------------------------------------------------------------------

ALTER TABLE HOCVIEN ADD CONSTRAINT FK_HV_LOP FOREIGN KEY (MALOP) REFERENCES LOP(MALOP)

ALTER TABLE LOP ADD CONSTRAINT FK_LOP_HV FOREIGN KEY (TRGLOP) REFERENCES HOCVIEN(MAHV),
				CONSTRAINT FK_LOP_GV FOREIGN KEY (MAGVCN) REFERENCES GIAOVIEN(MAGV)

ALTER TABLE KHOA ADD CONSTRAINT FK_KHOA_GV FOREIGN KEY (TRGKHOA) REFERENCES GIAOVIEN(MAGV)

ALTER TABLE MONHOC ADD CONSTRAINT FK_MH_KHOA FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA)

ALTER TABLE DIEUKIEN ADD CONSTRAINT FK_DK_MH FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH),
						CONSTRAINT FK_DK_MHTRC FOREIGN KEY (MAMH_TRUOC) REFERENCES MONHOC(MAMH)

ALTER TABLE GIAOVIEN ADD CONSTRAINT FK_GV_KHOA FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA)

ALTER TABLE GIANGDAY ADD CONSTRAINT FK_GD_LOP FOREIGN KEY (MALOP) REFERENCES LOP(MALOP),
						CONSTRAINT FK_GD_MH FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH),
						CONSTRAINT FK_GD_GV FOREIGN KEY (MAGV) REFERENCES GIAOVIEN(MAGV)

ALTER TABLE KETQUATHI ADD CONSTRAINT FK_KQT_HV FOREIGN KEY (MAHV) REFERENCES HOCVIEN(MAHV),
						CONSTRAINT FK_KQT_MH FOREIGN KEY (MAMH) REFERENCES MONHOC(MAMH)

-------------------------------------------------------------
ALTER TABLE LOP DROP CONSTRAINT FK_LOP_GV
DELETE FROM GIAOVIEN

drop table khoa
drop table monhoc
drop table dieukien
drop table giaovien
drop table lop
drop table hocvien
drop table giangday
drop table ketquathi


--------------------------------------------------------------------------------------------------

SET DATEFORMAT DMY
-----------------
/*Nhập dữ liệu KHOA*/
INSERT INTO KHOA VALUES('KHMT','Khoa hoc may tinh','7/6/2005','GV01')
INSERT INTO KHOA VALUES('HTTT','He thong thong tin','7/6/2005','GV02')
INSERT INTO KHOA VALUES('CNPM','Cong nghe phan mem','7/6/2005','GV04')
INSERT INTO KHOA VALUES('MTT','Mang va truyen thong','20/10/2005','GV03')
INSERT INTO KHOA VALUES('KTMT','Ky thuat may tinh','20/12/2005','Null')

------------------
/*Nhập dữ liệu LOP*/
INSERT INTO LOP VALUES('K11','Lop 1 khoa 1','K1108',11,'GV07')
INSERT INTO LOP VALUES('K12','Lop 2 khoa 1','K1205',12,'GV09')
INSERT INTO LOP VALUES('K13','Lop 3 khoa 1','K1305',12,'GV14')
-----------------
/*Nhập dữ liệu MONHOC*/
INSERT INTO MONHOC VALUES('THDC','Tin hoc dai cuong',4,1,'KHMT')
INSERT INTO MONHOC VALUES('CTRR','Cau truc roi rac',5,0,'KHMT')
INSERT INTO MONHOC VALUES('CSDL','Co so du lieu',3,1,'HTTT')
INSERT INTO MONHOC VALUES('CTDLGT','Cau truc du lieu va giai thuat',3,1,'KHMT')
INSERT INTO MONHOC VALUES('PTTKTT','Phan tich thiet ke thuat toan',3,0,'KHMT')
INSERT INTO MONHOC VALUES('DHMT','Do hoa may tinh',3,1,'KHMT')
INSERT INTO MONHOC VALUES('KTMT','Kien truc may tinh',3,0,'KTMT')
INSERT INTO MONHOC VALUES('TKCSDL','Thiet ke co so du lieu',3,1,'HTTT')
INSERT INTO MONHOC VALUES('PTTKHTTT','Phan tich thiet ke he thong thong tin',4,1,'HTTT')
INSERT INTO MONHOC VALUES('HDH','He dieu hanh',4,0,'KTMT')
INSERT INTO MONHOC VALUES('NMCNPM','Nhap mon cong nghe phan mem',3,0,'CNPM')
INSERT INTO MONHOC VALUES('LTCFW','Lap trinh C for win',3,1,'CNPM')
INSERT INTO MONHOC VALUES('LTHDT','Lap trinh huong doi tuong',3,1,'CNPM')
--------------------------------
SET DATEFORMAT DMY
/*Nhập dữ liệu GIAOVIEN*/
INSERT INTO GIAOVIEN VALUES('GV01','Ho Thanh Son','PTS','GS','Nam','2/5/1950','11/1/2004',5,2250000,'KHMT')
INSERT INTO GIAOVIEN VALUES('GV02','Tran Tam Thanh','TS','PGS','Nam','17/12/1965','20/4/2004',4.5,2025000,'HTTT')
INSERT INTO GIAOVIEN VALUES('GV03','Do Nghiem Phung','TS','GS','Nu','1/8/1950','23/9/2004',4,1800000,'CNPM')
INSERT INTO GIAOVIEN VALUES('GV04','Tran Nam Son','TS','PGS','Nam','22/2/1961','12/1/2005',4.5,2025000,'KTMT')
INSERT INTO GIAOVIEN VALUES('GV05','Mai Thanh Danh','ThS','GV','Nam','12/3/1958','12/1/2005',3,1350000,'HTTT')
INSERT INTO GIAOVIEN VALUES('GV06','Tran Doan Hung','TS','GV','Nam','11/3/1953','12/1/2005',4.5,2025000,'KHMT')
INSERT INTO GIAOVIEN VALUES('GV07','Nguyen Minh Tien','ThS','GV','Nam','23/11/1971','1/3/2005',4,1800000,'KHMT')
INSERT INTO GIAOVIEN VALUES('GV08','Le Thi Tran','KS','Null','Nu','26/3/1974','1/3/2005',1.69,760500,'KHMT')
INSERT INTO GIAOVIEN VALUES('GV09','Nguyen To Lan','ThS','GV','Nu','31/12/1966','1/3/2005',4,1800000,'HTTT')
INSERT INTO GIAOVIEN VALUES('GV10','Le Tran Anh Loan','KS','Null','Nu','17/7/1972','1/3/2005',1.86,837000,'CNPM')
INSERT INTO GIAOVIEN VALUES('GV11','Ho Thanh Tung','CN','GV','Nam','12/1/1980','15/5/2005',2.67,1201500,'MTT')
INSERT INTO GIAOVIEN VALUES('GV12','Tran Van Anh','CN','Null','Nu','29/3/1981','15/5/2005',1.69,760500,'CNPM')
INSERT INTO GIAOVIEN VALUES('GV13','Nguyen Linh Dan','CN','Null','Nu','23/5/1980','15/5/2005',1.69,760500,'KTMT')
INSERT INTO GIAOVIEN VALUES('GV14','Truong Minh Chau','ThS','GV','Nu','30/11/1976','15/5/2005',3,1350000,'MTT')
INSERT INTO GIAOVIEN VALUES('GV15','Le Ha Thanh','ThS','GV','Nam','4/5/1978','15/5/2005',3,1350000,'KHMT')
--------------------------------
SET DATEFORMAT DMY
/*Nhập dữ liệu GIANGDAY*/
INSERT INTO GIANGDAY VALUES('K11','THDC','GV07',1,2006,'2/1/2006','12/5/2006')
INSERT INTO GIANGDAY VALUES('K12','THDC','GV06',1,2006,'2/1/2006','12/5/2006')
INSERT INTO GIANGDAY VALUES('K13','THDC','GV15',1,2006,'2/1/2006','12/5/2006')
INSERT INTO GIANGDAY VALUES('K11','CTRR','GV02',1,2006,'9/1/2006','17/5/2006')
INSERT INTO GIANGDAY VALUES('K12','CTRR','GV02',1,2006,'9/1/2006','17/5/2006')
INSERT INTO GIANGDAY VALUES('K13','CTRR','GV08',1,2006,'9/1/2006','17/5/2006')
INSERT INTO GIANGDAY VALUES('K11','CSDL','GV05',2,2006,'1/6/2006','15/7/2006')
INSERT INTO GIANGDAY VALUES('K12','CSDL','GV09',2,2006,'1/6/2006','15/7/2006')
INSERT INTO GIANGDAY VALUES('K13','CTDLGT','GV15',2,2006,'1/6/2006','15/7/2006')
INSERT INTO GIANGDAY VALUES('K13','CSDL','GV05',3,2006,'1/8/2006','15/12/2006')
INSERT INTO GIANGDAY VALUES('K13','DHMT','GV07',3,2006,'1/8/2006','15/12/2006')
INSERT INTO GIANGDAY VALUES('K11','CTDLGT','GV15',3,2006,'1/8/2006','15/12/2006')
INSERT INTO GIANGDAY VALUES('K12','CTDLGT','GV15',3,2006,'1/8/2006','15/12/2006')
INSERT INTO GIANGDAY VALUES('K11','HDH','GV04',1,2007,'2/1/2007','18/2/2007')
INSERT INTO GIANGDAY VALUES('K12','HDH','GV04',1,2007,'2/1/2007','20/3/2007')
INSERT INTO GIANGDAY VALUES('K11','DHMT','GV07',1,2007,'18/2/2007','20/3/2007')
------------------
/*Nhập dữ liệu DIEUKIEN*/
INSERT INTO DIEUKIEN VALUES('CSDL','CTRR')
INSERT INTO DIEUKIEN VALUES('CSDL','CTDLGT')
INSERT INTO DIEUKIEN VALUES('CTDLGT','THDC')
INSERT INTO DIEUKIEN VALUES('PTTKTT','THDC')
INSERT INTO DIEUKIEN VALUES('PTTKTT','CTDLGT')
INSERT INTO DIEUKIEN VALUES('DHMT','THDC')
INSERT INTO DIEUKIEN VALUES('LTHDT','THDC')
INSERT INTO DIEUKIEN VALUES('PTTKHTTT','CSDL')
--------------------
/*Nhập dữ liệu HOCVIEN*/
INSERT INTO HOCVIEN VALUES('K1101','Nguyen Van','A','27/1/1986','Nam','TpHCM','K11')
INSERT INTO HOCVIEN VALUES('K1102','Tran Ngoc','Han','14/3/1986','Nu','Kien Giang','K11')
INSERT INTO HOCVIEN VALUES('K1103','Ha Duy','Lap','18/4/1986','Nam','Nghe An','K11')
INSERT INTO HOCVIEN VALUES('K1104','Tran Ngoc','Linh','30/3/1986','Nu','Tay Ninh','K11')
INSERT INTO HOCVIEN VALUES('K1105','Tran Minh','Long','27/2/1986','Nam','TpHCM','K11')
INSERT INTO HOCVIEN VALUES('K1106','Le Nhat','Minh','24/1/1986','Nam','TpHCM','K11')
INSERT INTO HOCVIEN VALUES('K1107','Nguyen Nhu','Nhut','27/1/1986','Nam','Ha Noi','K11')
INSERT INTO HOCVIEN VALUES('K1108','Nguyen Manh','Tam','27/2/1986','Nam','Kien Giang','K11')
INSERT INTO HOCVIEN VALUES('K1109','Phan Thi Thanh','Tam','27/1/1986','Nu','Vinh Long','K11')
INSERT INTO HOCVIEN VALUES('K1110','Le Hoai','Thuong','5/2/1986','Nu','Can Tho','K11')
INSERT INTO HOCVIEN VALUES('K1111','Le Ha','Vinh','25/12/1986','Nam','Vinh Long','K11')
INSERT INTO HOCVIEN VALUES('K1201','Nguyen Van','B','11/2/1986','Nam','TpHCM','K12')
INSERT INTO HOCVIEN VALUES('K1202','Nguyen Thi Kim','Duyen','18/1/1986','Nu','TpHCM','K12')
INSERT INTO HOCVIEN VALUES('K1203','Tran Thi Kim','Duyen','17/9/1986','Nu','TpHCM','K12')
INSERT INTO HOCVIEN VALUES('K1204','Truong My','Hanh','19/5/1986','Nu','Dong Nai','K12')
INSERT INTO HOCVIEN VALUES('K1205','Nguyen Thanh','Nam','17/4/1986','Nam','TpHCM','K12')
INSERT INTO HOCVIEN VALUES('K1206','Nguyen Thi Truc','Thanh','4/3/1986','Nu','Kien Giang','K12')
INSERT INTO HOCVIEN VALUES('K1207','Tran Thi Bich','Thuy','8/2/1986','Nu','Nghe An','K12')
INSERT INTO HOCVIEN VALUES('K1208','Huynh Thi Kim','Trieu','8/4/1986','Nu','Tay Ninh','K12')
INSERT INTO HOCVIEN VALUES('K1209','Pham Thanh','Trieu','23/2/1986','Nam','TpHCM','K12')
INSERT INTO HOCVIEN VALUES('K1210','Ngo Thanh','Tuan','14/2/1986','Nam','TpHCM','K12')
INSERT INTO HOCVIEN VALUES('K1211','Do Thi','Xuan','9/3/1986','Nu','Ha Noi','K12')
INSERT INTO HOCVIEN VALUES('K1212','Le Thi Phi','Yen','12/3/1986','Nu','TpHCM','K12')
INSERT INTO HOCVIEN VALUES('K1301','Nguyen Thi Kim','Cuc','9/6/1986','Nu','Kien Giang','K13')
INSERT INTO HOCVIEN VALUES('K1302','Truong Thi My','Hien','18/3/1986','Nu','Nghe An','K13')
INSERT INTO HOCVIEN VALUES('K1303','Le Duc','Hien','21/3/1986','Nam','Tay Ninh','K13')
INSERT INTO HOCVIEN VALUES('K1304','Le Quang','Hien','18/4/1986','Nam','TpHCM','K13')
INSERT INTO HOCVIEN VALUES('K1305','Le Thi','Huong','27/3/1986','Nu','TpHCM','K13')
INSERT INTO HOCVIEN VALUES('K1306','Nguyen Thai','Huu','30/3/1986','Nam','Ha Noi','K13')
INSERT INTO HOCVIEN VALUES('K1307','Tran Minh','Man','28/5/1986','Nam','TpHCM','K13')
INSERT INTO HOCVIEN VALUES('K1308','Nguyen Hieu','Nghia','8/4/1986','Nam','Kien Giang','K13')
INSERT INTO HOCVIEN VALUES('K1309','Nguyen Trung','Nghia','18/1/1987','Nam','Nghe An','K13')
INSERT INTO HOCVIEN VALUES('K1310','Tran Thi Hong','Tham','22/4/1986','Nu','Tay Ninh','K13')
INSERT INTO HOCVIEN VALUES('K1311','Tran Minh','Thuc','4/4/1986','Nam','TpHCM','K13')
INSERT INTO HOCVIEN VALUES('K1312','Nguyen Thi Kim','Yen','7/9/1986','Nu','TpHCM','K13')
-------------------------
/*Nhập dữ liệu KETQUATHI*/
INSERT INTO KETQUATHI VALUES('K1101','CSDL',1,'20/7/2006',10,'Dat')
INSERT INTO KETQUATHI VALUES('K1101','CTDLGT',1,'28/12/2006',9,'Dat')
INSERT INTO KETQUATHI VALUES('K1101','THDC',1,'20/5/2006',9,'Dat')
INSERT INTO KETQUATHI VALUES('K1101','CTRR',1,'13/5/2006',9.5,'Dat')
INSERT INTO KETQUATHI VALUES('K1102','CSDL',1,'20/7/2006',4,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1102','CSDL',2,'27/7/2006',4.25,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1102','CSDL',3,'10/8/2006',4.5,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1102','CTDLGT',1,'28/12/2006',4.5,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1102','CTDLGT',2,'5/1/2007',4,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1102','CTDLGT',3,'15/1/2007',6,'Dat')
INSERT INTO KETQUATHI VALUES('K1102','THDC',1,'20/5/2006',5,'Dat')
INSERT INTO KETQUATHI VALUES('K1102','CTRR',1,'13/5/2006',7,'Dat')
INSERT INTO KETQUATHI VALUES('K1103','CSDL',1,'20/7/2006',3.5,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1103','CSDL',2,'27/7/2006',8.25,'Dat')
INSERT INTO KETQUATHI VALUES('K1103','CTDLGT',1,'28/12/2006',7,'Dat')
INSERT INTO KETQUATHI VALUES('K1103','THDC',1,'20/5/2006',8,'Dat')
INSERT INTO KETQUATHI VALUES('K1103','CTRR',1,'13/5/2006',6.5,'Dat')
INSERT INTO KETQUATHI VALUES('K1104','CSDL',1,'20/7/2006',3.75,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1104','CTDLGT',1,'28/12/2006',4,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1104','THDC',1,'20/5/2006',4,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1104','CTRR',1,'13/5/2006',4,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1104','CTRR',2,'20/5/2006',3.5,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1104','CTRR',3,'30/6/2006',4,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1201','CSDL',1,'20/7/2006',6,'Dat')
INSERT INTO KETQUATHI VALUES('K1201','CTDLGT',1,'28/12/2006',5,'Dat')
INSERT INTO KETQUATHI VALUES('K1201','THDC',1,'20/5/2006',8.5,'Dat')
INSERT INTO KETQUATHI VALUES('K1201','CTRR',1,'13/5/2006',9,'Dat')
INSERT INTO KETQUATHI VALUES('K1202','CSDL',1,'20/7/2006',8,'Dat')
INSERT INTO KETQUATHI VALUES('K1202','CTDLGT',1,'28/12/2006',4,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1202','CTDLGT',2,'5/1/2007',5,'Dat')
INSERT INTO KETQUATHI VALUES('K1202','THDC',1,'20/5/2006',4,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1202','THDC',2,'27/5/2006',4,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1202','CTRR',1,'13/5/2006',3,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1202','CTRR',2,'20/5/2006',4,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1202','CTRR',3,'30/6/2006',6.25,'Dat')
INSERT INTO KETQUATHI VALUES('K1203','CSDL',1,'20/7/2006',9.25,'Dat')
INSERT INTO KETQUATHI VALUES('K1203','CTDLGT',1,'28/12/2006',9.5,'Dat')
INSERT INTO KETQUATHI VALUES('K1203','THDC',1,'20/5/2006',10,'Dat')
INSERT INTO KETQUATHI VALUES('K1203','CTRR',1,'13/5/2006',10,'Dat')
INSERT INTO KETQUATHI VALUES('K1204','CSDL',1,'20/7/2006',8.5,'Dat')
INSERT INTO KETQUATHI VALUES('K1204','CTDLGT',1,'28/12/2006',6.75,'Dat')
INSERT INTO KETQUATHI VALUES('K1204','THDC',1,'20/5/2006',4,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1204','CTRR',1,'13/5/2006',6,'Dat')
INSERT INTO KETQUATHI VALUES('K1301','CSDL',1,'20/12/2006',4.25,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1301','CTDLGT',1,'25/7/2006',8,'Dat')
INSERT INTO KETQUATHI VALUES('K1301','THDC',1,'20/5/2006',7.75,'Dat')
INSERT INTO KETQUATHI VALUES('K1301','CTRR',1,'13/5/2006',8,'Dat')
INSERT INTO KETQUATHI VALUES('K1302','CSDL',1,'20/12/2006',6.75,'Dat')
INSERT INTO KETQUATHI VALUES('K1302','CTDLGT',1,'25/7/2006',5,'Dat')
INSERT INTO KETQUATHI VALUES('K1302','THDC',1,'20/5/2006',8,'Dat')
INSERT INTO KETQUATHI VALUES('K1302','CTRR',1,'13/5/2006',8.5,'Dat')
INSERT INTO KETQUATHI VALUES('K1303','CSDL',1,'20/12/2006',4,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1303','CTDLGT',1,'25/7/2006',4.5,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1303','CTDLGT',2,'7/8/2006',4,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1303','CTDLGT',3,'15/8/2006',4.25,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1303','THDC',1,'20/5/2006',4.5,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1303','CTRR',1,'13/5/2006',3.25,'Khong Dat')
INSERT INTO KETQUATHI VALUES('K1303','CTRR',2,'20/5/2006',5,'Dat')
INSERT INTO KETQUATHI VALUES('K1304','CSDL',1,'20/12/2006',7.75,'Dat')
INSERT INTO KETQUATHI VALUES('K1304','CTDLGT',1,'25/7/2006',9.75,'Dat')
INSERT INTO KETQUATHI VALUES('K1304','THDC',1,'20/5/2006',5.5,'Dat')
INSERT INTO KETQUATHI VALUES('K1304','CTRR',1,'13/5/2006',5,'Dat')
INSERT INTO KETQUATHI VALUES('K1305','CSDL',1,'20/12/2006',9.25,'Dat')
INSERT INTO KETQUATHI VALUES('K1305','CTDLGT',1,'25/7/2006',10,'Dat')
INSERT INTO KETQUATHI VALUES('K1305','THDC',1,'20/5/2006',8,'Dat')
INSERT INTO KETQUATHI VALUES('K1305','CTRR',1,'13/5/2006',10,'Dat')


--------------------------------------------------------------------------------------

SELECT * FROM khoa
SELECT * FROM monhoc
SELECT * FROM ketquathi
SELECT * FROM hocvien
SELECT * FROM dieukien
SELECT * FROM giaovien
SELECT * FROM lop
SELECT * FROM giangday



----------------------------------------------------------------------

/* I. Ngon ngu dinh nghia du lieu */

-- 1. Them thuoc tinh GHICHU, DIEMTB, XEPLOAI cho quan he HOCVIEN
ALTER TABLE HOCVIEN ADD GHICHU VARCHAR(50),
						DIEMTB NUMERIC(4,2),
						XEPLOAI VARCHAR(10)

-- 2. Ma hv la 1 chuoi 5 ky tu, 3 ky tu dau la ma lop, 2 ky tu cuoi la STT hv
ALTER TABLE HOCVIEN ADD CONSTRAINT CHK_MAHV_LOP CHECK(LEFT(MAHV, 3) = MALOP)
ALTER TABLE HOCVIEN ADD CONSTRAINT CHK_MAHV_STT CHECK(RIGHT(MAHV, 2) >= '00' AND RIGHT(MAHV, 2) <= '99')

-- 3. Thuoc tinh GIOITINH chi co gia tri 'Nam' hoac 'Nu'
ALTER TABLE HOCVIEN ADD CONSTRAINT CHK_HV_GT CHECK (GIOITINH IN ('Nam', 'Nu'))
ALTER TABLE GIAOVIEN ADD CONSTRAINT CHK_GV_GT CHECK (GIOITINH IN ('Nam', 'Nu'))

-- 4. Diem so cua 1 lan thi co gia tri tu 0 -> 10 va can luu den 2 so le
ALTER TABLE KETQUATHI ADD CONSTRAINT CHK_DIEM CHECK (DIEM >= 0 AND DIEM <= 10)

-- 5. KQT la 'Dat' neu diem tu 5 -> 10, 'Khong dat' neu diem < 5
ALTER TABLE KETQUATHI ADD CONSTRAINT CHK_KQT CHECK ((KQUA = 'Dat' AND DIEM >=5) OR (KQUA = 'Khong dat' AND DIEM < 5))

-- 6. HV thi 1 mon toi da 3 lan
ALTER TABLE KETQUATHI ADD CONSTRAINT CHK_LANTHI CHECK (LANTHI <= 3)

-- 7. Hoc ky co gia tri tu 1 -> 3
ALTER TABLE GIANGDAY ADD CONSTRAINT CHK_HK CHECK (HOCKY >=1 AND HOCKY <= 3)

-- 8. Hoc vi cua GV chi co the la 'CN', 'KS', 'Ths', 'TS', 'PTS'
ALTER TABLE GIAOVIEN ADD CONSTRAINT CHK_HOCVI CHECK (HOCVI IN ('CN', 'KS', 'Ths', 'TS', 'PTS'))


--------------------------------------------------------------------------------------------------


/* II. Ngon ngu thao tac du lieu */

-- 1.
UPDATE GIAOVIEN
SET HESO = HESO + 0.2
WHERE MAGV IN ( SELECT TRGKHOA FROM KHOA )

-- 2.
UPDATE HOCVIEN
SET DIEMTB = (
	SELECT AVG(K1.DIEM)
	FROM KETQUATHI AS K1
	WHERE K1.LANTHI = (	SELECT MAX(K2.LANTHI) FROM KETQUATHI AS K2
						WHERE K2.MAHV = K1.MAHV AND K1.MAMH = K2.MAMH
						GROUP BY K2.MAMH, K2.MAMH )
	GROUP BY MAHV
	HAVING K1.MAHV = HOCVIEN.MAHV)



-- 3.
UPDATE HOCVIEN
SET GHICHU = 'Cam thi'
WHERE MAHV IN ( SELECT MAHV
				FROM KETQUATHI
				WHERE LANTHI = 3 AND DIEM < 5)














-----------------------------------------/* LAB 4: III.5 -> III.35 */------------------------------------------------------------------------------





-- 5. * Danh sách học viên (mã học viên, họ tên) của lớp “K” thi môn CTRR không đạt (ở tất cả các lần thi). 
SELECT MAHV, CONCAT(HO, ' ', TEN) AS HOTEN
FROM HOCVIEN 
WHERE MAHV IN (	SELECT MAHV
				FROM KETQUATHI
				WHERE MAMH = 'CTRR'
				GROUP BY MAHV
				HAVING COUNT(MAMH) >= (	SELECT COUNT (DISTINCT LANTHI)
										FROM KETQUATHI	)	)


-- 6. Tìm tên những môn học mà giáo viên có tên “Tran Tam Thanh” dạy trong học kỳ 1 năm 2006. 
SELECT DISTINCT TENMH
FROM MONHOC MH
	JOIN GIANGDAY GD ON MH.MAMH = GD.MAMH
	JOIN GIAOVIEN GV ON GV.MAGV = GD.MAGV
WHERE HOTEN = 'Tran Tam Thanh' AND HOCKY = 1 AND YEAR(TUNGAY) = 2006


-- 7. Tìm những môn học (mã môn học, tên môn học) mà giáo viên chủ nhiệm lớp “K11” dạy trong học kỳ 1 năm 2006. 
SELECT DISTINCT TENMH
FROM MONHOC MH
	JOIN GIANGDAY GD ON MH.MAMH = GD.MAMH
	JOIN GIAOVIEN GV ON GV.MAGV = GD.MAGV
	JOIN LOP L ON GV.MAGV = L.MAGVCN
WHERE L.MALOP = 'K11' AND HOCKY = 1 AND YEAR(TUNGAY) = 2006


-- 8. Tìm họ tên lớp trưởng của các lớp mà giáo viên có tên “Nguyen To Lan” dạy môn “Co So Du Lieu”. 
SELECT CONCAT(HO, ' ', TEN) AS HOTEN_LTRG
FROM HOCVIEN HV
	JOIN LOP L ON L.TRGLOP = HV.MAHV
	JOIN GIANGDAY GD ON GD.MALOP = L.MALOP
	JOIN GIAOVIEN GV ON GV.MAGV = GD.MAGV
	JOIN MONHOC MH ON MH.MAMH = GD.MAMH
WHERE HOTEN = 'Nguyen To Lan' AND TENMH = 'Co so du lieu'


-- 9. In ra danh sách những môn học (mã môn học, tên môn học) phải học liền trước môn “Co So Du Lieu”. 
SELECT DK.MAMH_TRUOC, MH2.TENMH
FROM MONHOC MH
	JOIN DIEUKIEN DK ON DK.MAMH = MH.MAMH
	JOIN MONHOC MH2 ON DK.MAMH_TRUOC = MH2.MAMH
WHERE MH.TENMH = 'Co so du lieu'


-- 10. Môn “Cau Truc Roi Rac” là môn bắt buộc phải học liền trước những môn học (mã môn học, tên môn học) nào. 
SELECT MH.MAMH, TENMH
FROM MONHOC MH
	JOIN DIEUKIEN DK ON DK.MAMH = MH.MAMH
WHERE MAMH_TRUOC = (	SELECT MAMH
						FROM MONHOC
						WHERE TENMH = 'Cau truc roi rac'	)


-- 11. Tìm họ tên giáo viên dạy môn CTRR cho cả hai lớp “K11” và “K12” trong cùng học kỳ 1 năm 2006. 
SELECT HOTEN
FROM GIAOVIEN GV
	JOIN GIANGDAY GD ON GD.MAGV = GV.MAGV
WHERE MAMH = 'CTRR' AND  HOCKY = 1 AND YEAR(TUNGAY) = 2006 AND MALOP = 'K11'
INTERSECT
SELECT HOTEN
FROM GIAOVIEN GV
	JOIN GIANGDAY GD ON GD.MAGV = GV.MAGV
WHERE MAMH = 'CTRR' AND  HOCKY = 1 AND YEAR(TUNGAY) = 2006 AND MALOP = 'K12'


-- 12. Tìm những học viên (mã học viên, họ tên) thi không đạt môn CSDL ở lần thi thứ 1 nhưng chưa thi lại môn này. 
SELECT HV.MAHV, CONCAT(HO, ' ', TEN) AS HOTEN
FROM HOCVIEN HV
	JOIN KETQUATHI KQT ON KQT.MAHV = HV.MAHV
WHERE (LANTHI = 1 AND KQUA = 'Khong Dat') AND MAMH = 'CSDL'
EXCEPT
SELECT HV.MAHV, CONCAT(HO, ' ', TEN)
FROM HOCVIEN HV
	JOIN KETQUATHI KQT ON KQT.MAHV = HV.MAHV
WHERE LANTHI > 1 AND MAMH = 'CSDL'


-- 13. Tìm giáo viên (mã giáo viên, họ tên) không được phân công giảng dạy bất kỳ môn học nào. 
SELECT MAGV, HOTEN
FROM GIAOVIEN
EXCEPT
SELECT GV.MAGV, HOTEN
FROM GIAOVIEN GV
	JOIN GIANGDAY GD ON GD.MAGV = GV.MAGV


-- 14. Tìm giáo viên (mã giáo viên, họ tên) không được phân công giảng dạy bất kỳ môn học nào thuộc khoa giáo viên đó phụ trách. 
SELECT MAGV, HOTEN
FROM GIAOVIEN
EXCEPT
SELECT GV.MAGV, HOTEN
FROM GIAOVIEN GV
	JOIN GIANGDAY GD ON GD.MAGV = GV.MAGV
	JOIN MONHOC MH ON MH.MAMH = GD.MAMH
WHERE MH.MAKHOA = GV.MAKHOA


-- 15. Tìm họ tên các học viên thuộc lớp “K11” thi một môn bất kỳ quá 3 lần vẫn “Khong dat” hoặc thi lần thứ 2 môn CTRR được 5 điểm. 
SELECT CONCAT(HO, ' ', TEN) AS HOTEN
FROM HOCVIEN HV
	JOIN KETQUATHI KQT ON KQT.MAHV = HV.MAHV
WHERE (MALOP = 'K11' AND LANTHI > 3 AND KQUA = 'Khong Dat')
	OR (LANTHI = 2 AND MAMH = 'CTRR' AND DIEM = 5)



-- 16. Tìm họ tên giáo viên dạy môn CTRR cho ít nhất hai lớp trong cùng một học kỳ của một năm học. 
SELECT HOTEN
FROM GIAOVIEN GV 
	JOIN GIANGDAY GD ON GD.MAGV = GV.MAGV
WHERE MAMH = 'CTRR'
GROUP BY HOTEN
HAVING COUNT(MALOP) >=2


-- 17. Danh sách học viên và điểm thi môn CSDL (chỉ lấy điểm của lần thi sau cùng). 
SELECT HV.MAHV, HO, TEN, DIEM
FROM HOCVIEN HV
	JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
WHERE MAMH = 'CSDL' AND LANTHI = (	SELECT MAX(LANTHI)
									FROM KETQUATHI K1
									WHERE K1.MAHV = KQT.MAHV AND MAMH = 'CSDL'	)


-- 18. Danh sách học viên và điểm thi môn “Co So Du Lieu” (chỉ lấy điểm cao nhất của các lần thi). 
SELECT HV.MAHV, HO, TEN, DIEM
FROM HOCVIEN HV
	JOIN KETQUATHI KQT ON HV.MAHV = KQT.MAHV
WHERE MAMH = 'CSDL' AND DIEM = (	SELECT MAX(DIEM)
									FROM KETQUATHI K1
									WHERE K1.MAHV = KQT.MAHV AND MAMH = 'CSDL'	)


-- 19. Khoa nào (mã khoa, tên khoa) được thành lập sớm nhất. 
SELECT MAKHOA, TENKHOA
FROM KHOA
WHERE NGTLAP = (	SELECT MIN(NGTLAP)
					FROM KHOA	)


-- 20. Có bao nhiêu giáo viên có học hàm là “GS” hoặc “PGS”.
SELECT COUNT(MAGV) AS SOGV
FROM GIAOVIEN
WHERE HOCHAM IN ('GS', 'PGS')


-- 21. Thống kê có bao nhiêu giáo viên có học vị là “CN”, “KS”, “Ths”, “TS”, “PTS” trong mỗi khoa. 
SELECT MAKHOA, COUNT(*) AS SOGV
FROM GIAOVIEN
WHERE HOCVI IN ('CN', 'KS', 'Ths', 'TS', 'PTS')
GROUP BY MAKHOA


-- 22. Mỗi môn học thống kê số lượng học viên theo kết quả (đạt và không đạt). 
WITH KETQUACUOI AS (	SELECT MAHV, MAMH, KQUA
						FROM KETQUATHI K1
						WHERE LANTHI = (	SELECT MAX(LANTHI)
											FROM KETQUATHI K2
											WHERE K1.MAHV = K2.MAHV AND K1.MAMH = K2.MAMH	))
SELECT S1.MAMH, S1.SLDAT, S2.SLKDAT
FROM (
		SELECT MAMH, COUNT(*) AS SLDAT
		FROM KETQUACUOI
		WHERE KQUA = 'Dat'
		GROUP BY MAMH) AS S1
JOIN (
		SELECT MAMH, COUNT(*) AS SLKDAT
		FROM KETQUACUOI
		WHERE KQUA = 'Khong Dat'
		GROUP BY MAMH) AS S2
ON S1.MAMH = S2.MAMH
			   
			   
-- 23. Tìm giáo viên (mã giáo viên, họ tên) là giáo viên chủ nhiệm của một lớp, đồng thời dạy cho lớp đó ít nhất một môn học. 
SELECT DISTINCT GV.MAGV, HOTEN
FROM GIAOVIEN GV
	JOIN LOP L ON L.MAGVCN = GV.MAGV
	JOIN GIANGDAY GD ON GD.MAGV = GV.MAGV


-- 24. Tìm họ tên lớp trưởng của lớp có sỉ số cao nhất. 
SELECT HO+' '+TEN AS HOTEN
FROM HOCVIEN HV
	JOIN LOP L ON L.TRGLOP = HV.MAHV
WHERE SISO = (	SELECT MAX(SISO)
				FROM LOP)


-- 25. * Tìm họ tên những LOPTRG thi không đạt quá 3 môn (mỗi môn đều thi không đạt ở tất cả các lần thi). 

SELECT HO, TEN
FROM HOCVIEN HV
	JOIN LOP L ON L.TRGLOP = HV.MAHV
WHERE MAHV IN (	SELECT MAHV
				FROM KETQUATHI K1
				WHERE KQUA = 'Khong Dat'
						AND LANTHI = (	SELECT MAX(LANTHI)
										FROM KETQUATHI K2
										WHERE K1.MAHV = K2.MAHV AND K1.MAMH = K2.MAMH	)
				GROUP BY MAHV
				HAVING COUNT(MAMH) > 3	)


-- 26. Tìm học viên (mã học viên, họ tên) có số môn đạt điểm 9,10 nhiều nhất. 
SELECT HV.MAHV, HO, TEN
FROM HOCVIEN HV
	JOIN KETQUATHI KQT ON KQT.MAHV = HV.MAHV
WHERE DIEM >= 9
GROUP BY HV.MAHV, HO, TEN
HAVING COUNT(*) >= ALL (	SELECT COUNT(*)
							FROM KETQUATHI
							WHERE DIEM >= 9
							GROUP BY MAHV	)



-- 27. Trong từng lớp, tìm học viên (mã học viên, họ tên) có số môn đạt điểm 9,10 nhiều nhất. 

SELECT
	MaLop, MaHV, HoTen
FROM
(
	SELECT
		MaLop, HocVien.MaHV, (Ho+' '+Ten) HoTen, COUNT(*) SoLuongDiem, RANK() OVER (PARTITION BY MaLop ORDER BY COUNT(*) DESC) AS XepHang
	FROM
		HocVien, KetQuaThi
	WHERE
		HocVien.MaHV = KetQuaThi.MaHV
		AND Diem >= 9
	GROUP BY
		MaLop, HocVien.MaHV, Ho, Ten
) AS A
WHERE
	A.XepHang = 1



-- 28. Trong từng học kỳ của từng năm, mỗi giáo viên phân công dạy bao nhiêu môn học, bao nhiêu lớp. 
SELECT HOCKY, YEAR(TUNGAY) AS NAM, MAGV, COUNT(DISTINCT MAMH) AS SOMH, COUNT(DISTINCT MALOP) AS SOLOP
FROM GIANGDAY GD
GROUP BY MAGV, HOCKY, YEAR(TUNGAY)
ORDER BY YEAR(TUNGAY), HOCKY


-- 29. Trong từng học kỳ của từng năm, tìm giáo viên (mã giáo viên, họ tên) giảng dạy nhiều nhất. 
SELECT HocKy, Nam, A.MaGV, HoTen
FROM GiaoVien,
(
	SELECT 
		HocKy, Nam, MaGV, RANK() OVER (PARTITION BY HocKy, Nam ORDER BY COUNT(*) DESC) AS XepHang
	FROM GiangDay
	GROUP BY HocKy, Nam, MaGV
) AS A
WHERE
	A.MAGV = GiaoVien.MAGV
	AND XepHang = 1
ORDER BY
	Nam, HocKy



-- 30. Tìm môn học (mã môn học, tên môn học) có nhiều học viên thi không đạt (ở lần thi thứ 1) nhất. 
SELECT MH.MAMH, TENMH
FROM MONHOC MH
	JOIN KETQUATHI KQT ON KQT.MAMH = MH.MAMH
WHERE LANTHI = 1 AND KQUA = 'Khong Dat'
GROUP BY MH.MAMH, TENMH
HAVING COUNT(MH.MAMH) >= ALL (	SELECT COUNT(*)
								FROM KETQUATHI
								WHERE LANTHI = 1 AND KQUA = 'Khong Dat'
								GROUP BY MAMH	)


-- 31. Tìm học viên (mã học viên, họ tên) thi môn nào cũng đạt (chỉ xét lần thi thứ 1). 
SELECT DISTINCT HV.MAHV, HO, TEN
FROM HOCVIEN HV
	JOIN KETQUATHI KQT ON KQT.MAHV = HV.MAHV
WHERE LANTHI = 1 AND KQUA = 'Dat'


-- 32. * Tìm học viên (mã học viên, họ tên) thi môn nào cũng đạt (chỉ xét lần thi sau cùng). 
SELECT DISTINCT HV.MAHV, HO, TEN
FROM HOCVIEN HV
	JOIN KETQUATHI KQT ON KQT.MAHV = HV.MAHV
EXCEPT
SELECT DISTINCT HV.MAHV, HO, TEN
FROM HOCVIEN HV
	JOIN KETQUATHI K1 ON K1.MAHV = HV.MAHV
WHERE KQUA = 'Khong Dat' AND LANTHI = (	SELECT MAX(LANTHI)
										FROM KETQUATHI K2
										WHERE K2.MAHV = K1.MAHV AND K2.MAMH = K1.MAMH	)


-- 33. * Tìm học viên (mã học viên, họ tên) đã thi tất cả các môn đều đạt (chỉ xét lần thi thứ 1). 
SELECT HV.MAHV, HO, TEN
FROM HOCVIEN HV
	JOIN KETQUATHI KQT ON KQT.MAHV = HV.MAHV
WHERE NOT EXISTS (	SELECT *
					FROM MONHOC MH
					WHERE NOT EXISTS (	SELECT *
										FROM KETQUATHI KQT
										WHERE KQT.MAMH = MH.MAMH
											AND KQT.MAHV = HV.MAHV	)	)
	AND LANTHI = 1 AND KQUA = 'Dat'


-- 34. * Tìm học viên (mã học viên, họ tên) đã thi tất cả các môn đều đạt  (chỉ xét lần thi sau cùng). 
SELECT HV.MAHV, HO, TEN
FROM HOCVIEN HV
	JOIN KETQUATHI KQT ON KQT.MAHV = HV.MAHV
WHERE NOT EXISTS (	SELECT *
					FROM MONHOC MH
					WHERE NOT EXISTS (	SELECT *
										FROM KETQUATHI KQT
										WHERE KQT.MAMH = MH.MAMH
											AND KQT.MAHV = HV.MAHV	)	)
	AND KQUA = 'Dat' AND LANTHI = (	SELECT MAX(LANTHI)
										FROM KETQUATHI K2
										WHERE K2.MAHV = KQT.MAHV AND K2.MAMH = KQT.MAMH	)


-- 35. ** Tìm học viên (mã học viên, họ tên) có điểm thi cao nhất trong từng môn (lấy điểm ở lần thi sau cùng).
SELECT HV.MAHV, HO, TEN, MAMH, DIEM
FROM HOCVIEN HV
	JOIN KETQUATHI KQT ON KQT.MAHV = HV.MAHV
WHERE DIEM = (	SELECT MAX(DIEM)
				FROM KETQUATHI K1
				WHERE LANTHI = (	SELECT MAX(LANTHI)
									FROM KETQUATHI K2
									WHERE K2.MAHV = K1.MAHV AND K2.MAMH = K1.MAMH	))













